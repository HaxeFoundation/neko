language: cpp

os:
  - linux
  - osx

install:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then
        sudo apt-get update -qq;
        sudo apt-get install zlib1g-dev libgc-dev -qq;
    elif [ "${TRAVIS_OS_NAME}" = "osx" ]; then
        brew tap homebrew/dupes;
        brew update;
        brew install bdw-gc pcre openssl zlib;
        brew link zlib --force;
    fi

script:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then
        make;
        make test;
        sudo make install;
    elif [ "${TRAVIS_OS_NAME}" = "osx" ]; then
        make os=osx LIB_PREFIX=/usr/local;
        brew install homebrew/apache/httpd22;
        make os=osx LIB_PREFIX=/usr/local libs;
        make test;
        sudo make os=osx install;
    fi
  - ls bin
  - neko -version
  - neko src/tools/test.n